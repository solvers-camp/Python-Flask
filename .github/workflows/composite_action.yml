name: Python CI/CD

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests
      run: pytest

    - name: Deploy to Production
      uses: "solvers-camp/Python-Flask@latest"
      with:
        repo_token: "${{ secrets.GITHUB_TOKEN }}"
        prerelease: false
        files: "app.py index.html about.html contact.html contact_confirmation.html"
        release_name: "Release $(date +'%Y-%m-%d %H:%M:%S')"
        tag: "v$(date +'%Y%m%d%H%M%S')"
        body: "Automated release generated by GitHub Actions."
